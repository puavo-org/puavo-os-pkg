#!/bin/sh

set -eu

command=$1
shift

case "${command}" in
    configure)
        upstream_dir=$1

        ln -fns "$upstream_dir" /opt/next-exam-puavo-student
        ln -fns "${upstream_dir}/next-exam-puavo-student.png" /usr/share/icons/next-exam-puavo-student.png
        cat <<EOF > /usr/share/applications/next-exam-puavo-student.desktop
[Desktop Entry]
Name=Next-Exam Student
Exec=/opt/next-exam-puavo-student/Next-Exam-Puavo-Student.AppImage
Type=Application
Terminal=false
Icon=next-exam-puavo-student
StartupNotify=true
Categories=Internet;
EOF
        ;;
    unconfigure)
        rm -f /opt/next-exam-puavo-student \
              /usr/share/applications/next-exam-puavo-student.desktop \
              /usr/share/icons/next-exam-puavo-student.png
        ;;
    unpack)
        upstream_pack=$1
        upstream_dir=$2

        cp "$upstream_pack" "${upstream_dir}/Next-Exam-Puavo-Student.AppImage"
        chmod 755 "${upstream_dir}/Next-Exam-Puavo-Student.AppImage"
        cp -p next-exam-puavo-student.png "$upstream_dir"
        ;;
    *)
        ;;
esac
